<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Test PJI</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link rel="stylesheet" href="">
        <style>
            .bar:hover {
              fill: brown;
            }
          </style>
        <script src="https://d3js.org/d3.v4.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3-scale-radial.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="../scripts/get_flight.js"></script>

    </head>
    <body>
        <div id="inf50"></div>
        <div id="groupedCountries"style="display: flex;">
            <div id="sup50inf250"></div>
            <div id="sup250inf1600"></div>
            <div id="sup1600"></div>
        </div>

        <script>
            const attendees2019 = [{country : 'United States', count : 1163},{country : 'United Kingdom', count : 715},{country : 'Germany', count : 336},{country : 'Canada', count : 172}, 
               {country : 'Korea, Republic of', count : 137},{country : 'Japan', count : 136},{country : 'China', count : 93},{country : 'Netherlands', count : 83},{country : 'France', count : 78}, 
               {country : 'Denmark', count : 75},{country : 'Australia', count : 66},{country : 'Sweden', count : 58},{country : 'Austria', count : 54},{country : 'Switzerland', count : 51},{country : 'Taiwan', count : 38}, 
               {country : 'Finland', count : 37},{country : 'Portugal', count : 34},{country : 'Italy', count : 28},{country : 'Belgium', count : 27},{country : 'Ireland', count : 26},{country : 'Israel', count : 25}, 
               {country : 'India', count : 24},{country : 'Singapore', count : 20},{country : 'Spain', count : 18},{country : 'Hong Kong', count : 15},{country : 'Norway', count : 14},{country : 'Brazil', count : 12}, 
               {country : 'Poland', count : 11},{country : 'New Zealand', count : 10},{country : 'Greece', count : 8},{country : 'United Arab Emirates', count : 7},{country : 'Czech Republic', count : 6}, 
               {country : 'Russia', count : 6},{country : 'Bangladesh', count : 5},{country : 'Malaysia', count : 5},{country : 'Turkey', count : 5},{country : 'Cyprus', count : 4},{country : 'Luxembourg', count : 4}, 
               {country : 'Pakistan', count : 4},{country : 'Ukraine', count : 4},{country : 'Qatar', count : 3},{country : 'Romania', count : 3},{country : 'Slovenia', count : 3},{country : 'Hungary', count : 3},{country : 'Namibia', count : 2}, 
               {country : 'Nigeria', count : 2},{country : 'Saudi Arabia', count : 2},{country : 'Malta', count : 2},{country : 'Mexico', count : 2},{country : 'Argentina', count : 2},{country : 'Indonesia', count : 2}, 
               {country : 'Egypt', count : 1},{country : 'Gabon', count : 1},{country : 'Jordan', count : 1},{country : 'Macao', count : 1},{country : 'South Africa', count : 1},{country : 'Colombia', count : 1},{country : 'Kuwait', count : 1}, 
               {country : 'Ecuador', count : 1},{country : 'Iceland', count : 1},{country : 'Kenya', count : 1},{country : 'Uruguay', count : 1},{country : 'Estonia', count : 1}];
            var continents;

            
            function pushDataIfNotEmpty(d, origins){
                if(d != ""){
                    origins.push(d);
                }
            }
            
            const w = 1300;
            const h = 700;
            const padding = 110;

        

            function displayPlot(data, year = null){
                var origins = [];
                const counts = new Map();
                const svg = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
                data.forEach(function(d) { 
                    if(year == 2016){
                        pushDataIfNotEmpty(d.y2016, origins);
                    } else if (year == 2017){
                        pushDataIfNotEmpty(d.y2017, origins);
                    } else if (year == 2018) {
                        pushDataIfNotEmpty(d.y2018, origins);
                    } else if (year == 2019){
                        pushDataIfNotEmpty(d.y2019, origins);
                    } else {
                        pushDataIfNotEmpty(d.y2016, origins);
                        pushDataIfNotEmpty(d.y2017, origins);
                        pushDataIfNotEmpty(d.y2018, origins);
                        pushDataIfNotEmpty(d.y2019, origins);
                    }
                 });
                 origins.forEach(country => {
                    counts.set(country,counts.get(country) ? counts.get(country) + 1 : 1);
                 });
                
                
                const countValues = Array.from(counts.values())
                const countries = Array.from(counts.entries())

                d3.csv('../Countries-Continents.csv', function(data){
                    continents = new Map(data.map(d => [d.Country, d.Continent]));
                    countries.forEach(country => {
                        country.push(continents.get(country[0]));
                    });
                    countries.sort(function(a, b) {
                        return (a[2] < b[2]) ? -1 : (a[2] > b[2]) ? 1 : 0; 
                    });
                    const xScale = d3.scaleLinear()
                    .domain([0, countValues.length])
                    .range([padding, w - padding]);

                const yScale = d3.scaleSqrt()
                    .domain([1, d3.max(countValues)])
                    .range([padding, h - 2*padding]);

                const yScale2 = d3.scaleSqrt()
                    .domain([1,d3.max(countValues)])
                    .range([h - 2*padding, padding]);


                svg.selectAll("rect")
                    .data(countries)
                    .enter()
                    .append("rect")
                    .attr("x", (d, i) => xScale(i))
                    .attr("y", (d, i) => h - yScale(d[1]) - padding)
                    .attr("width", 10) 
                    .attr("height", (d, i) => yScale(d[1]))
                    .attr("fill", function(d) {
                        if(d[2] == 'Asia'){
                            return "yellow"
                        } else if(d[2] == 'Africa'){
                            return "plum"
                        } else if (d[2] == 'Europe'){
                            return "skyblue"
                        } else if (d[2] == 'North America'){
                            return "red"
                        } else if (d[2] == 'South America'){
                            return "orange"
                        } else if (d[2] == 'Oceania'){
                            return "navy"
                        }
                    })
                    .attr("class", "bar")
                    .append("title")
                    .text((d) => d[1]);

                const yAxis = d3.axisLeft(yScale2);

 
                svg.append("g")
                .attr("transform", "translate("+padding+",0)")
                .call(yAxis);

                svg.append("g")
                .selectAll("text")
                .data(countries)
                .enter()
                .append("text")
                .text((d) => d[0])
                .attr("x", (d, i) => h - padding)
                .attr("y", (d, i) => - xScale(i) -1)
                .attr("class", "barTitle")
                .attr("transform", "rotate(90)")
                .attr("font-size", "13");

                if(year){
                    year = year.toString();
                } else{
                    year = "2016-2019";
                }

                svg.append("g")
                .append("text")
                .text("Nombre de participants par pays à la conférence CHI (".concat(year).concat(")"))
                .attr("x", 300)
                .attr("y", 125)
                .attr("font-size", 20)
                .attr("text-decoration", "underline")
                });


                svg.append("circle").attr("cx",1100).attr("cy",60).attr("r", 6).style("fill", "plum")
                svg.append("text").attr("x", 1110).attr("y", 65).text("Africa").style("font-size", "15px").attr("alignment-baseline","middle")
                svg.append("circle").attr("cx",1100).attr("cy",80).attr("r", 6).style("fill", "yellow")
                svg.append("text").attr("x", 1110).attr("y", 85).text("Asia").style("font-size", "15px").attr("alignment-baseline","middle")
                svg.append("circle").attr("cx",1100).attr("cy",100).attr("r", 6).style("fill", "skyblue")
                svg.append("text").attr("x", 1110).attr("y", 105).text("Europe").style("font-size", "15px").attr("alignment-baseline","middle")
                svg.append("circle").attr("cx",1100).attr("cy",120).attr("r", 6).style("fill", "red")
                svg.append("text").attr("x", 1110).attr("y", 125).text("North America").style("font-size", "15px").attr("alignment-baseline","middle")
                svg.append("circle").attr("cx",1100).attr("cy",140).attr("r", 6).style("fill", "navy")
                svg.append("text").attr("x", 1110).attr("y", 145).text("Oceania").style("font-size", "15px").attr("alignment-baseline","middle")
                svg.append("circle").attr("cx",1100).attr("cy",160).attr("r", 6).style("fill", "orange")
                svg.append("text").attr("x", 1110).attr("y", 165).text("South America").style("font-size", "15px").attr("alignment-baseline","middle")
            }

            d3.csv('../chi-data.csv', displayPlot); 
            d3.csv('../chi-data.csv', (d) => displayPlot(d, 2016)); 
            d3.csv('../chi-data.csv', (d) => displayPlot(d, 2017)); 
            d3.csv('../chi-data.csv', (d) => displayPlot(d, 2018)); 
            d3.csv('../chi-data.csv', (d) => displayPlot(d, 2019)); 

            d3.csv('../flight_database_full.csv', function(data){
                var carbonMap = new Map();
                var timeMap = new Map();
                var cpt = new Map();
                var carbonGlaMap = new Map();
                var timeGlaMap = new Map();
                var cptGla = new Map();
                data.forEach(function(d){
                    var seconds = d.temps_vol.split(":");
                    seconds = parseInt(seconds[0]) + parseInt(seconds[1])/60 + parseInt(seconds[2]/3600)
                    var emission = parseFloat(d.emission_CO2)
                    cpt.set(d.arrivee, cpt.get(d.arrivee) ? cpt.get(d.arrivee) + 1 : 1);
                    carbonMap.set(d.arrivee, carbonMap.get(d.arrivee) ? (carbonMap.get(d.arrivee)*(cpt.get(d.arrivee)-1) + emission) / cpt.get(d.arrivee) : emission);
                    timeMap.set(d.arrivee, timeMap.get(d.arrivee) ? (timeMap.get(d.arrivee)*(cpt.get(d.arrivee)-1) + seconds) / cpt.get(d.arrivee) : seconds);
                    if(d.arrivee == "GLA"){
                        cptGla.set(d.depart, cptGla.get(d.depart) ? cptGla.get(d.depart) + 1 : 1);
                        carbonGlaMap.set(d.depart, carbonGlaMap.get(d.depart) ? (carbonGlaMap.get(d.depart)*(cptGla.get(d.depart)-1) + emission) / cptGla.get(d.depart) : emission);
                        timeGlaMap.set(d.depart, timeGlaMap.get(d.depart) ? (timeGlaMap.get(d.depart)*(cptGla.get(d.depart)-1) + seconds) / cptGla.get(d.depart) : seconds);
                    }
                });

                var time = Array.from(timeMap).sort(function(b, a) {
                    return b[1] - a[1];
                });
                var carbon = Array.from(carbonMap).sort(function(a,b){
                    return a[1] - b[1];
                });


                var margin = {top: 30, right: 30, bottom: 70, left: 60},
                    widthTime = w - margin.left - margin.right,
                    heightTime = h - margin.top - margin.bottom;

                // append the svg object to the body of the page
                var svg = d3.select("body")
                .append("svg")
                    .attr("width", widthTime + margin.left + margin.right)
                    .attr("height", heightTime + margin.top + margin.bottom)
                .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");

                

                // X axis
                var x = d3.scaleBand()
                    .range([ 0, widthTime ])
                    .domain(time.map(function(d) { return d[0]; }))
                    .padding(0.2);
                svg.append("g")
                    .attr("transform", "translate(0," + heightTime + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0, 6])
                    .range([ heightTime, 0]);
                svg.append("g")
                    .call(d3.axisLeft(y));

                // Bars
                svg.selectAll("mybar")
                    .data(time)
                    .enter()
                    .append("rect")
                    .attr("x", function(d) { return x(d[0]); })
                    .attr("y", function(d) { return y(d[1]); })
                    .attr("width", x.bandwidth())
                    .attr("height", function(d) { return heightTime - y(d[1]); })
                    .attr("fill", "#69b3a2")
                    .append("title")
                    .text((d) => '0' + parseInt(d[1]) + ':' + (parseInt((d[1]%1)*60).toString().length == 1 ? '0' : '') + parseInt((d[1]%1)*60));

                svg.append("g")
                    .append("text")
                    .text("Temps moyen de vol en heures par aéroport d'arrivée")
                    .attr("x", 300)
                    .attr("y", 65)
                    .attr("font-size", 20)
                    .attr("text-decoration", "underline");
                

                var margin = {top: 20, right: 30, bottom: 40, left: 90},
                    widthCarbon = w - margin.left - margin.right,
                    heightCarbon = h - margin.top - margin.bottom;

                // append the svg object to the body of the page
                var svg = d3.select("body")
                .append("svg")
                    .attr("width", widthCarbon + margin.left + margin.right)
                    .attr("height", heightCarbon + margin.top + margin.bottom)
                .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");

                var x = d3.scaleLinear()
                    .domain([0, Math.max(...carbonMap.values())])
                    .range([ 0, widthCarbon]);
                svg.append("g")
                    .attr("transform", "translate(0," + heightCarbon + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");

                // Y axis
                var y = d3.scaleBand()
                    .range([ 0, heightCarbon ])
                    .domain(Array.from(carbon.map(function(d) { return d[0]; })))
                    .padding(.1);
                svg.append("g")
                    .call(d3.axisLeft(y))

                svg.append("text")
                    .attr("class", "x label")
                    .attr("text-anchor", "end")
                    .attr("x", widthCarbon/2 + margin.left)
                    .attr("y", heightCarbon + 37)
                    .text("Moyenne des estimations de CO2 (arrondi au kg)");

                //Bars
                svg.selectAll("myRect")
                    .data(carbon)
                    .enter().append("rect")
                        .attr("x", x(0) )
                        .attr("y", function(d) { return y(d[0]); })
                        .attr("width", function(d) { return x(d[1]); })
                        .attr("height", y.bandwidth() )
                        .attr("fill", "#69b3a2")
                        .append("title")
                        .text((d) => Math.round(d[1]))

                
                var timeGla = Array.from(timeGlaMap).sort(function(b, a) {
                    return b[1] - a[1];
                });
                var carbonGla = Array.from(carbonGlaMap).sort(function(a,b){
                    return a[1] - b[1];
                });


                var margin = {top: 30, right: 30, bottom: 70, left: 60},
                    widthTime = w - margin.left - margin.right,
                    heightTime = h - margin.top - margin.bottom;

                // append the svg object to the body of the page
                var svg = d3.select("body")
                .append("svg")
                    .attr("width", widthTime + margin.left + margin.right)
                    .attr("height", heightTime + margin.top + margin.bottom)
                .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");

                

                // X axis
                var x = d3.scaleBand()
                    .range([ 0, widthTime ])
                    .domain(timeGla.map(function(d) { return d[0]; }))
                    .padding(0.2);
                svg.append("g")
                    .attr("transform", "translate(0," + heightTime + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0, Math.max(...timeGlaMap.values())])
                    .range([ heightTime, 0]);
                svg.append("g")
                    .call(d3.axisLeft(y));

                // Bars
                svg.selectAll("mybar")
                    .data(timeGla)
                    .enter()
                    .append("rect")
                    .attr("x", function(d) { return x(d[0]); })
                    .attr("y", function(d) { return y(d[1]); })
                    .attr("width", x.bandwidth())
                    .attr("height", function(d) { return heightTime - y(d[1]); })
                    .attr("fill", "#69b3a2")
                    .append("title")
                    .text((d) => '0' + parseInt(d[1]) + ':' + (parseInt((d[1]%1)*60).toString().length == 1 ? '0' : '') + parseInt((d[1]%1)*60));

                svg.append("g")
                    .append("text")
                    .text("Temps moyen (en heures) des vols à destination de Glasgow")
                    .attr("x", 300)
                    .attr("y", 65)
                    .attr("font-size", 20)
                    .attr("text-decoration", "underline");
                

                var margin = {top: 20, right: 30, bottom: 40, left: 90},
                    widthCarbon = w - margin.left - margin.right,
                    heightCarbon = h - margin.top - margin.bottom;

                // append the svg object to the body of the page
                var svg = d3.select("body")
                .append("svg")
                    .attr("width", widthCarbon + margin.left + margin.right)
                    .attr("height", heightCarbon + margin.top + margin.bottom)
                .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");

                var x = d3.scaleLinear()
                    .domain([0, Math.max(...carbonGlaMap.values())])
                    .range([ 0, widthCarbon]);
                svg.append("g")
                    .attr("transform", "translate(0," + heightCarbon + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");

                // Y axis
                var y = d3.scaleBand()
                    .range([ 0, heightCarbon ])
                    .domain(Array.from(carbonGla.map(function(d) { return d[0]; })))
                    .padding(.1);
                svg.append("g")
                    .call(d3.axisLeft(y))

                svg.append("text")
                    .attr("class", "x label")
                    .attr("text-anchor", "end")
                    .attr("x", 800)
                    .attr("y", heightCarbon + 37)
                    .text("Moyenne des estimations de CO2 (arrondie au kg) pour les vols à destination de Glasgow");

                //Bars
                svg.selectAll("myRect")
                    .data(carbonGla)
                    .enter().append("rect")
                        .attr("x", x(0) )
                        .attr("y", function(d) { return y(d[0]); })
                        .attr("width", function(d) { return x(d[1]); })
                        .attr("height", y.bandwidth() )
                        .attr("fill", "#69b3a2")
                        .append("title")
                        .text((d) => Math.round(d[1]))


            });


            // set the dimensions and margins of the graph
            var margin = {top: 10, right: 30, bottom: 20, left: 50},
                widthAttendees = w - margin.left - margin.right,
                heightAttendees = h - margin.top - margin.bottom;

            // append the svg object to the body of the page
            var svg = d3.select("body")
            .append("svg")
                .attr("width", widthAttendees + margin.left + margin.right)
                .attr("height", heightAttendees + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var svg2 = d3.select("#inf50")
            .append("svg")
                .attr("width", widthAttendees + margin.left + margin.right)
                .attr("height", heightAttendees + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var svg3 = d3.select("#sup50inf250")
            .append("svg")
                .attr("width", widthAttendees/2 + margin.left + margin.right)
                .attr("height", heightAttendees + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");
            
            var svg4 = d3.select("#sup250inf1600")
            .append("svg")
                .attr("width", widthAttendees/3 + margin.left + margin.right)
                .attr("height", heightAttendees + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var svg5 = d3.select("#sup1600")
            .append("svg")
                .attr("width", widthAttendees/6 + margin.left + margin.right)
                .attr("height", heightAttendees + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // Parse the Data
            d3.csv("../chi-countries-counts.csv", function(data) {
                /*********************STACK BAR ALL COUNTRIES*********************/
                // List of subgroups = header of the csv files = soil condition here
                var subgroups = data.columns.slice(1)

                // List of groups = species here = value of the first column called group -> I show them on the X axis
                var countries = d3.map(data, function(d){return(d.Country)}).keys()

                // Add X axis
                var x = d3.scaleBand()
                    .domain(countries)
                    .range([0, widthAttendees])
                    .padding([0.2])
                svg.append("g")
                    .attr("transform", "translate(0," + (heightAttendees - 80) + ")")
                    .call(d3.axisBottom(x).tickSizeOuter(0))
                    .selectAll("text")
                    .style("text-anchor", "start")
                    .attr("transform", "translate(12,0),rotate(45)")
                    .attr("font-size", "13");

                // Add Y axis
                var y = d3.scaleSqrt()
                    .domain([0, 6600])
                    .range([ heightAttendees - 80, 0 ]);
                svg.append("g")
                    .call(d3.axisLeft(y));

                // color palette = one color per subgroup
                var color = d3.scaleOrdinal()
                    .domain(subgroups)
                    .range(['skyblue','orange','lightgray', 'lightgreen'])

                //stack the data? --> stack per subgroup
                var stackedData = d3.stack()
                    .keys(subgroups)
                    (data)


                // Show the bars
                svg.append("g")
                    .selectAll("g")
                    // Enter in the stack data = loop key per key = group per group
                    .data(stackedData)
                    .enter().append("g")
                    .attr("fill", function(d) { return color(d.key); })
                    .selectAll("rect")
                    // enter a second time = loop subgroup per subgroup to add all rectangles
                    .data(function(d) { return d; })
                    .enter().append("rect")
                        .attr("x", function(d) { return x(d.data.Country); })
                        .attr("y", function(d) { return y(d[1]); })
                        .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                        .attr("width",x.bandwidth())
                        .append("title")
                        .text((d) => d[1]-d[0]);

                svg.append("g")
                    .append("text")
                    .text("Nombre de participants par pays à la conférence CHI (2016-2019)")
                    .attr("x", 200)
                    .attr("y", 65)
                    .attr("font-size", 20)
                    .attr("text-decoration", "underline");

                svg.append("circle").attr("cx",1100).attr("cy",60).attr("r", 6).style("fill", "skyblue")
                svg.append("text").attr("x", 1110).attr("y", 65).text("2016").style("font-size", "15px").attr("alignment-baseline","middle")
                svg.append("circle").attr("cx",1100).attr("cy",80).attr("r", 6).style("fill", "orange")
                svg.append("text").attr("x", 1110).attr("y", 85).text("2017").style("font-size", "15px").attr("alignment-baseline","middle")
                svg.append("circle").attr("cx",1100).attr("cy",100).attr("r", 6).style("fill", "lightgray")
                svg.append("text").attr("x", 1110).attr("y", 105).text("2018").style("font-size", "15px").attr("alignment-baseline","middle")
                svg.append("circle").attr("cx",1100).attr("cy",120).attr("r", 6).style("fill", "lightgreen")
                svg.append("text").attr("x", 1110).attr("y", 125).text("2019").style("font-size", "15px").attr("alignment-baseline","middle")
   

                /*********************STACK BAR COUNTRIES <= 50 *********************/

                const dataInf50 = data.filter(d => 
                        Object.values(d).slice(1).reduce((accumulator, currentValue) => accumulator + parseInt(currentValue), 0) <= 50
                )

                // List of groups = species here = value of the first column called group -> I show them on the X axis
                var countries = d3.map(dataInf50, function(d){return(d.Country)}).keys()

                // Add X axis
                var x = d3.scaleBand()
                    .domain(countries)
                    .range([0, widthAttendees])
                    .padding([0.2])
                svg2.append("g")
                    .attr("transform", "translate(0," + (heightAttendees - 80) + ")")
                    .call(d3.axisBottom(x).tickSizeOuter(0))
                    .selectAll("text")
                    .style("text-anchor", "start")
                    .attr("transform", "translate(12,0),rotate(45)")
                    .attr("font-size", "13");

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0, 50])
                    .range([ heightAttendees - 80, 0 ]);
                svg2.append("g")
                    .call(d3.axisLeft(y));

                // color palette = one color per subgroup
                var color = d3.scaleOrdinal()
                    .domain(subgroups)
                    .range(['skyblue','orange','lightgray', 'lightgreen'])

                //stack the data? --> stack per subgroup
                var stackedData = d3.stack()
                    .keys(subgroups)
                    (dataInf50);



                // Show the bars
                svg2.append("g")
                    .selectAll("g")
                    // Enter in the stack data = loop key per key = group per group
                    .data(stackedData)
                    .enter().append("g")
                    .attr("fill", function(d) { return color(d.key); })
                    .selectAll("rect")
                    // enter a second time = loop subgroup per subgroup to add all rectangles
                    .data(function(d) { return d; })
                    .enter().append("rect")
                        .attr("x", function(d) { return x(d.data.Country); })
                        .attr("y", function(d) { return y(d[1]); })
                        .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                        .attr("width",x.bandwidth())
                        .append("title")
                        .text((d) => d[1]-d[0]);

                svg2.append("g")
                    .append("text")
                    .text("Nombre de participants par pays à la conférence CHI (2016-2019)")
                    .attr("x", 350)
                    .attr("y", 40)
                    .attr("font-size", 20)
                    .attr("text-decoration", "underline");
                
                svg2.append("g")
                    .append("text")
                    .text("Moins de 50 participants")
                    .attr("x", 30)
                    .attr("y", 30)
                    .attr("font-size", 15)

                svg2.append("circle").attr("cx",1100).attr("cy",60).attr("r", 6).style("fill", "skyblue")
                svg2.append("text").attr("x", 1110).attr("y", 65).text("2016").style("font-size", "15px").attr("alignment-baseline","middle")
                svg2.append("circle").attr("cx",1100).attr("cy",80).attr("r", 6).style("fill", "orange")
                svg2.append("text").attr("x", 1110).attr("y", 85).text("2017").style("font-size", "15px").attr("alignment-baseline","middle")
                svg2.append("circle").attr("cx",1100).attr("cy",100).attr("r", 6).style("fill", "lightgray")
                svg2.append("text").attr("x", 1110).attr("y", 105).text("2018").style("font-size", "15px").attr("alignment-baseline","middle")
                svg2.append("circle").attr("cx",1100).attr("cy",120).attr("r", 6).style("fill", "lightgreen")
                svg2.append("text").attr("x", 1110).attr("y", 125).text("2019").style("font-size", "15px").attr("alignment-baseline","middle")
                
                /*********************STACK BAR 50 < COUNTRIES <= 250 *********************/

                const dataSup50Inf150 = data.filter(d => 
                        Object.values(d).slice(1).reduce((accumulator, currentValue) => accumulator + parseInt(currentValue), 0) > 50 && Object.values(d).slice(1).reduce((accumulator, currentValue) => accumulator + parseInt(currentValue), 0) <= 250
                )

                // List of groups = species here = value of the first column called group -> I show them on the X axis
                var countries = d3.map(dataSup50Inf150, function(d){return(d.Country)}).keys()

                // Add X axis
                var x = d3.scaleBand()
                    .domain(countries)
                    .range([0, widthAttendees/2])
                    .padding([0.2])
                svg3.append("g")
                    .attr("transform", "translate(0," + (heightAttendees - 80) + ")")
                    .call(d3.axisBottom(x).tickSizeOuter(0))
                    .selectAll("text")
                    .style("text-anchor", "start")
                    .attr("transform", "translate(12,0),rotate(45)")
                    .attr("font-size", "13");

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0,250])
                    .range([ heightAttendees - 80, 0 ]);
                svg3.append("g")
                    .call(d3.axisLeft(y));

                // color palette = one color per subgroup
                var color = d3.scaleOrdinal()
                    .domain(subgroups)
                    .range(['skyblue','orange','lightgray', 'lightgreen'])

                //stack the data? --> stack per subgroup
                var stackedData = d3.stack()
                    .keys(subgroups)
                    (dataSup50Inf150);



                // Show the bars
                svg3.append("g")
                    .selectAll("g")
                    // Enter in the stack data = loop key per key = group per group
                    .data(stackedData)
                    .enter().append("g")
                    .attr("fill", function(d) { return color(d.key); })
                    .selectAll("rect")
                    // enter a second time = loop subgroup per subgroup to add all rectangles
                    .data(function(d) { return d; })
                    .enter().append("rect")
                        .attr("x", function(d) { return x(d.data.Country); })
                        .attr("y", function(d) { return y(d[1]); })
                        .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                        .attr("width",x.bandwidth())
                        .append("title")
                        .text((d) => d[1]-d[0]);

                svg3.append("g")
                    .append("text")
                    .text("Entre 50 et 250 participants")
                    .attr("x", 30)
                    .attr("y", 30)
                    .attr("font-size", 15)

                svg3.append("circle").attr("cx",1100).attr("cy",60).attr("r", 6).style("fill", "skyblue")
                svg3.append("text").attr("x", 1110).attr("y", 65).text("2016").style("font-size", "15px").attr("alignment-baseline","middle")
                svg3.append("circle").attr("cx",1100).attr("cy",80).attr("r", 6).style("fill", "orange")
                svg3.append("text").attr("x", 1110).attr("y", 85).text("2017").style("font-size", "15px").attr("alignment-baseline","middle")
                svg3.append("circle").attr("cx",1100).attr("cy",100).attr("r", 6).style("fill", "lightgray")
                svg3.append("text").attr("x", 1110).attr("y", 105).text("2018").style("font-size", "15px").attr("alignment-baseline","middle")
                svg3.append("circle").attr("cx",1100).attr("cy",120).attr("r", 6).style("fill", "lightgreen")
                svg3.append("text").attr("x", 1110).attr("y", 125).text("2019").style("font-size", "15px").attr("alignment-baseline","middle")
                

                /*********************STACK BAR 250 < COUNTRIES <= 1600 *********************/

                const dataSup250Inf500 = data.filter(d => 
                        Object.values(d).slice(1).reduce((accumulator, currentValue) => accumulator + parseInt(currentValue), 0) > 250 && Object.values(d).slice(1).reduce((accumulator, currentValue) => accumulator + parseInt(currentValue), 0) <= 1600
                )

                // List of groups = species here = value of the first column called group -> I show them on the X axis
                var countries = d3.map(dataSup250Inf500, function(d){return(d.Country)}).keys()

                // Add X axis
                var x = d3.scaleBand()
                    .domain(countries)
                    .range([0, widthAttendees/3])
                    .padding([0.2])
                svg4.append("g")
                    .attr("transform", "translate(0," + (heightAttendees - 80) + ")")
                    .call(d3.axisBottom(x).tickSizeOuter(0))
                    .selectAll("text")
                    .style("text-anchor", "start")
                    .attr("transform", "translate(12,0),rotate(45)")
                    .attr("font-size", "13");

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0,1600])
                    .range([ heightAttendees - 80, 0 ]);
                svg4.append("g")
                    .call(d3.axisLeft(y));

                // color palette = one color per subgroup
                var color = d3.scaleOrdinal()
                    .domain(subgroups)
                    .range(['skyblue','orange','lightgray', 'lightgreen'])

                //stack the data? --> stack per subgroup
                var stackedData = d3.stack()
                    .keys(subgroups)
                    (dataSup250Inf500);



                // Show the bars
                svg4.append("g")
                    .selectAll("g")
                    // Enter in the stack data = loop key per key = group per group
                    .data(stackedData)
                    .enter().append("g")
                    .attr("fill", function(d) { return color(d.key); })
                    .selectAll("rect")
                    // enter a second time = loop subgroup per subgroup to add all rectangles
                    .data(function(d) { return d; })
                    .enter().append("rect")
                        .attr("x", function(d) { return x(d.data.Country); })
                        .attr("y", function(d) { return y(d[1]); })
                        .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                        .attr("width",x.bandwidth())
                        .append("title")
                        .text((d) => d[1]-d[0]);

                svg4.append("g")
                    .append("text")
                    .text("Entre 250 et 1600 participants")
                    .attr("x", 30)
                    .attr("y", 30)
                    .attr("font-size", 15);

                svg4.append("circle").attr("cx",1100).attr("cy",60).attr("r", 6).style("fill", "skyblue")
                svg4.append("text").attr("x", 1110).attr("y", 65).text("2016").style("font-size", "15px").attr("alignment-baseline","middle")
                svg4.append("circle").attr("cx",1100).attr("cy",80).attr("r", 6).style("fill", "orange")
                svg4.append("text").attr("x", 1110).attr("y", 85).text("2017").style("font-size", "15px").attr("alignment-baseline","middle")
                svg4.append("circle").attr("cx",1100).attr("cy",100).attr("r", 6).style("fill", "lightgray")
                svg4.append("text").attr("x", 1110).attr("y", 105).text("2018").style("font-size", "15px").attr("alignment-baseline","middle")
                svg4.append("circle").attr("cx",1100).attr("cy",120).attr("r", 6).style("fill", "lightgreen")
                svg4.append("text").attr("x", 1110).attr("y", 125).text("2019").style("font-size", "15px").attr("alignment-baseline","middle")
                


                /*********************STACK BAR COUNTRIES > 1600 *********************/

                const dataSup150 = data.filter(d => 
                        Object.values(d).slice(1).reduce((accumulator, currentValue) => accumulator + parseInt(currentValue), 0) > 1600
                )

                // List of groups = species here = value of the first column called group -> I show them on the X axis
                var countries = d3.map(dataSup150, function(d){return(d.Country)}).keys()

                // Add X axis
                var x = d3.scaleBand()
                    .domain(countries)
                    .range([0, widthAttendees/6])
                    .padding([0.2])
                svg5.append("g")
                    .attr("transform", "translate(0," + (heightAttendees - 80) + ")")
                    .call(d3.axisBottom(x).tickSizeOuter(0))
                    .selectAll("text")
                    .style("text-anchor", "start")
                    .attr("transform", "translate(12,0),rotate(45)")
                    .attr("font-size", "13");

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0, 6700])
                    .range([ heightAttendees - 80, 0 ]);
                svg5.append("g")
                    .call(d3.axisLeft(y));

                // color palette = one color per subgroup
                var color = d3.scaleOrdinal()
                    .domain(subgroups)
                    .range(['skyblue','orange','lightgray', 'lightgreen'])

                //stack the data? --> stack per subgroup
                var stackedData = d3.stack()
                    .keys(subgroups)
                    (dataSup150);



                // Show the bars
                svg5.append("g")
                    .selectAll("g")
                    // Enter in the stack data = loop key per key = group per group
                    .data(stackedData)
                    .enter().append("g")
                    .attr("fill", function(d) { return color(d.key); })
                    .selectAll("rect")
                    // enter a second time = loop subgroup per subgroup to add all rectangles
                    .data(function(d) { return d; })
                    .enter().append("rect")
                        .attr("x", function(d) { return x(d.data.Country); })
                        .attr("y", function(d) { return y(d[1]); })
                        .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                        .attr("width",x.bandwidth())
                        .append("title")
                        .text((d) => d[1]-d[0]);

                svg5.append("g")
                    .append("text")
                    .text("Plus de 1600 participants")
                    .attr("x", 30)
                    .attr("y", 10)
                    .attr("font-size", 15);

                svg5.append("circle").attr("cx",1100).attr("cy",60).attr("r", 6).style("fill", "skyblue")
                svg5.append("text").attr("x", 1110).attr("y", 65).text("2016").style("font-size", "15px").attr("alignment-baseline","middle")
                svg5.append("circle").attr("cx",1100).attr("cy",80).attr("r", 6).style("fill", "orange")
                svg5.append("text").attr("x", 1110).attr("y", 85).text("2017").style("font-size", "15px").attr("alignment-baseline","middle")
                svg5.append("circle").attr("cx",1100).attr("cy",100).attr("r", 6).style("fill", "lightgray")
                svg5.append("text").attr("x", 1110).attr("y", 105).text("2018").style("font-size", "15px").attr("alignment-baseline","middle")
                svg5.append("circle").attr("cx",1100).attr("cy",120).attr("r", 6).style("fill", "lightgreen")
                svg5.append("text").attr("x", 1110).attr("y", 125).text("2019").style("font-size", "15px").attr("alignment-baseline","middle")
                
            });

            d3.csv('../busiest_airports.csv', function(data){
                const arrival_iata = "GLA";
                const airports = new Map();
                data.forEach(d => {
                    airports.set(d.country, d.iata);
                });
                attendees2019.forEach(attendee => {
                    if(attendee.count >= 10){
                        var iata = airports.get(attendee.country);
                        
                    }
                    
                });
            });
            getAirports(1, 2);
        </script>
     


    </body>
</html> 